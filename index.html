<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HostFree - Hosting Sederhana</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #4cc9f0;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .hamburger {
            display: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        h1, h2, h3 {
            margin-bottom: 1rem;
            color: var(--secondary);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input[type="text"],
        input[type="file"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        textarea {
            min-height: 200px;
            font-family: monospace;
            resize: vertical;
        }

        button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s;
        }

        button:hover {
            background: var(--secondary);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #d1146a;
        }

        .hidden {
            display: none;
        }

        .website-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .website-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .website-item:hover {
            transform: translateY(-5px);
        }

        .website-item h3 {
            margin-bottom: 10px;
            color: var(--primary);
        }

        .website-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        footer {
            background: var(--dark);
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--secondary);
                padding: 1rem;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .hamburger {
                display: block;
            }

            .card {
                padding: 1rem;
            }

            .website-list {
                grid-template-columns: 1fr;
            }

            button, input, textarea {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.4rem;
            }

            .container {
                padding: 0 10px;
            }

            .website-item {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">HostFree</div>
                <div class="hamburger" role="button" aria-label="Toggle navigation">â˜°</div>
                <div class="nav-links" id="nav-links">
                    <a href="#" id="home-link" aria-current="page">Beranda</a>
                    <a href="#" id="login-link" class="hidden">Login</a>
                    <a href="#" id="register-link" class="hidden">Daftar</a>
                    <a href="#" id="dashboard-link" class="hidden">Dashboard</a>
                    <a href="#" id="admin-link" class="hidden">Admin</a>
                    <a href="#" id="logout-link" class="hidden">Logout</a>
                </div>
            </nav>
        </div>
    </header>
    <div class="container main-content">
        <!-- Halaman Beranda -->
        <div id="home-page">
            <div class="card">
                <h1>Selamat Datang di HostFree</h1>
                <p>Platform hosting sederhana untuk website HTML Anda. Daftar sekarang dan mulai unggah kode HTML Anda untuk dihosting secara gratis!</p>
                <p>Fitur:</p>
                <ul>
                    <li>Hosting kode HTML tanpa batas</li>
                    <li>Link unik untuk setiap website</li>
                    <li>Antarmuka yang mudah digunakan</li>
                    <li>Unggah file HTML langsung</li>
                </ul>
            </div>
        </div>
        <!-- Halaman Login -->
        <div id="login-page" class="hidden">
            <div class="card">
                <h2>Login ke Akun Anda</h2>
                <div id="login-alert"></div>
                <div class="form-group">
                    <label for="login-username">Nama Pengguna</label>
                    <input type="text" id="login-username" placeholder="Masukkan nama pengguna" aria-required="true">
                </div>
                <button id="login-btn">Login</button>
            </div>
        </div>
        <!-- Halaman Daftar -->
        <div id="register-page" class="hidden">
            <div class="card">
                <h2>Buat Akun Baru</h2>
                <div id="register-alert"></div>
                <div class="form-group">
                    <label for="register-username">Nama Pengguna</label>
                    <input type="text" id="register-username" placeholder="Pilih nama pengguna (minimal 3 karakter)" aria-required="true">
                    <small>Nama pengguna hanya boleh mengandung huruf, angka, dan underscore</small>
                </div>
                <button id="register-btn">Daftar</button>
            </div>
        </div>
        <!-- Halaman Dashboard Pengguna -->
        <div id="dashboard-page" class="hidden">
            <div class="card">
                <h2>Dashboard Pengguna</h2>
                <p>Selamat datang, <span id="user-name"></span>!</p>
                <h3>Unggah Website Baru</h3>
                <div id="upload-alert"></div>
                <div class="form-group">
                    <label for="website-name">Nama Website</label>
                    <input type="text" id="website-name" placeholder="Masukkan nama website" aria-required="true">
                </div>
                <div class="form-group">
                    <label for="website-file">Unggah File HTML</label>
                    <input type="file" id="website-file" accept=".html" aria-describedby="file-help">
                    <small id="file-help">Pilih file HTML untuk diunggah</small>
                </div>
                <div class="form-group">
                    <label for="website-html">Kode HTML</label>
                    <textarea id="website-html" placeholder="Masukkan kode HTML Anda di sini atau unggah file di atas" aria-required="true"></textarea>
                </div>
                <button id="upload-btn">Unggah Website</button>
            </div>
            <div class="card">
                <h3>Website Saya</h3>
                <div id="websites-list" class="website-list">
                    <!-- Daftar website akan dimuat di sini -->
                </div>
            </div>
        </div>
        <!-- Halaman Admin -->
        <div id="admin-page" class="hidden">
            <div class="card">
                <h2>Panel Admin</h2>
                <p>Halaman ini hanya dapat diakses oleh administrator.</p>
                <h3>Daftar Pengguna</h3>
                <div id="users-list">
                    <!-- Daftar pengguna akan dimuat di sini -->
                </div>
            </div>
        </div>
    </div>
    <footer>
        <div class="container">
            <p>&copy; 2025 HostFree - Hosting Sederhana dengan Firebase</p>
        </div>
    </footer>
    <script>
        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAcwGj4DNCxtbgF73Szv54YZwh-fMse8lA",
            authDomain: "hosting-a3cf1.firebaseapp.com",
            databaseURL: "https://hosting-a3cf1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hosting-a3cf1",
            storageBucket: "hosting-a3cf1.firebasestorage.app",
            messagingSenderId: "65851407729",
            appId: "1:65851407729:web:439e00b8e48cadf22c0ad0",
            measurementId: "G-GRVKW11616"
        };

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Elemen DOM
        const homePage = document.getElementById('home-page');
        const loginPage = document.getElementById('login-page');
        const registerPage = document.getElementById('register-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const adminPage = document.getElementById('admin-page');
        const navLinks = document.getElementById('nav-links');
        const hamburger = document.querySelector('.hamburger');

        const homeLink = document.getElementById('home-link');
        const loginLink = document.getElementById('login-link');
        const registerLink = document.getElementById('register-link');
        const dashboardLink = document.getElementById('dashboard-link');
        const adminLink = document.getElementById('admin-link');
        const logoutLink = document.getElementById('logout-link');

        const loginUsername = document.getElementById('login-username');
        const loginBtn = document.getElementById('login-btn');
        const loginAlert = document.getElementById('login-alert');

        const registerUsername = document.getElementById('register-username');
        const registerBtn = document.getElementById('register-btn');
        const registerAlert = document.getElementById('register-alert');

        const userName = document.getElementById('user-name');
        const websiteName = document.getElementById('website-name');
        const websiteFile = document.getElementById('website-file');
        const websiteHtml = document.getElementById('website-html');
        const uploadBtn = document.getElementById('upload-btn');
        const uploadAlert = document.getElementById('upload-alert');
        const websitesList = document.getElementById('websites-list');

        const usersList = document.getElementById('users-list');

        // State aplikasi
        let currentUser = null;
        let isAdmin = false;

        // Fungsi untuk menampilkan halaman dengan animasi
        function showPage(page) {
            const pages = [homePage, loginPage, registerPage, dashboardPage, adminPage];
            pages.forEach(p => p.classList.add('hidden'));
            page.classList.remove('hidden');
            page.style.opacity = '0';
            setTimeout(() => {
                page.style.transition = 'opacity 0.3s ease';
                page.style.opacity = '1';
            }, 10);
        }

        // Fungsi untuk update UI berdasarkan status auth
        function updateUI(user) {
            if (user) {
                loginLink.classList.add('hidden');
                registerLink.classList.add('hidden');
                dashboardLink.classList.remove('hidden');
                logoutLink.classList.remove('hidden');
                adminLink.classList.toggle('hidden', !isAdmin);
            } else {
                loginLink.classList.remove('hidden');
                registerLink.classList.remove('hidden');
                dashboardLink.classList.add('hidden');
                adminLink.classList.add('hidden');
                logoutLink.classList.add('hidden');
                showPage(homePage);
            }
            navLinks.classList.remove('active');
        }

        // Fungsi untuk sanitasi HTML (mencegah XSS)
        function sanitizeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // Fungsi untuk login
        function login(username) {
            if (!username || username.length < 3) {
                showAlert(loginAlert, 'error', 'Nama pengguna harus minimal 3 karakter');
                return;
            }

            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const userData = Object.values(snapshot.val())[0];
                        currentUser = userData;

                        if (username === "hengki") {
                            const password = prompt("Masukkan password admin:");
                            if (password !== "hengki141516") {
                                showAlert(loginAlert, 'error', 'Password admin salah');
                                return;
                            }
                            isAdmin = true;
                        } else {
                            isAdmin = false;
                        }

                        updateUI(currentUser);
                        userName.textContent = userData.username;
                        showPage(dashboardPage);
                        loadUserWebsites(userData.uid);
                        loginUsername.value = '';
                        loginAlert.innerHTML = '';
                    } else {
                        showAlert(loginAlert, 'error', 'Nama pengguna tidak ditemukan');
                    }
                })
                .catch(error => {
                    console.error('Error during login:', error);
                    showAlert(loginAlert, 'error', 'Terjadi kesalahan saat login');
                });
        }

        // Fungsi untuk registrasi
        function register(username) {
            if (!username || username.length < 3) {
                showAlert(registerAlert, 'error', 'Nama pengguna harus minimal 3 karakter');
                return;
            }

            const usernameRegex = /^[a-zA-Z0-9_]+$/;
            if (!usernameRegex.test(username)) {
                showAlert(registerAlert, 'error', 'Nama pengguna hanya boleh mengandung huruf, angka, dan underscore');
                return;
            }

            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showAlert(registerAlert, 'error', 'Nama pengguna sudah digunakan');
                    } else {
                        const uid = generateUID();
                        const userData = {
                            uid: uid,
                            username: username,
                            createdAt: Date.now()
                        };

                        database.ref('users/' + uid).set(userData)
                            .then(() => {
                                showAlert(registerAlert, 'success', 'Pendaftaran berhasil! Silakan login');
                                registerUsername.value = '';
                                setTimeout(() => showPage(loginPage), 2000);
                            })
                            .catch(error => {
                                console.error('Error saving user:', error);
                                showAlert(registerAlert, 'error', 'Terjadi kesalahan saat mendaftar');
                            });
                    }
                })
                .catch(error => {
                    console.error('Error checking username:', error);
                    showAlert(registerAlert, 'error', 'Terjadi kesalahan saat mendaftar');
                });
        }

        // Fungsi untuk mengunggah website
        function uploadWebsite() {
            const name = websiteName.value.trim();
            const html = websiteHtml.value.trim();

            if (!name) {
                showAlert(uploadAlert, 'error', 'Nama website harus diisi');
                return;
            }

            if (!html) {
                showAlert(uploadAlert, 'error', 'Kode HTML harus diisi');
                return;
            }

            const websiteId = generateUID();
            const websiteData = {
                id: websiteId,
                name: sanitizeHTML(name),
                html: html, // Sanitasi dilakukan saat rendering
                owner: currentUser.uid,
                ownerName: currentUser.username,
                createdAt: Date.now(),
                url: `${window.location.origin}${window.location.pathname}?website=${websiteId}`
            };

            database.ref('websites/' + websiteId).set(websiteData)
                .then(() => {
                    database.ref('userWebsites/' + currentUser.uid + '/' + websiteId).set(true)
                        .then(() => {
                            showAlert(uploadAlert, 'success', 'Website berhasil diunggah!');
                            websiteName.value = '';
                            websiteHtml.value = '';
                            websiteFile.value = '';
                            loadUserWebsites(currentUser.uid);
                        })
                        .catch(error => {
                            console.error('Error saving user website reference:', error);
                            showAlert(uploadAlert, 'error', 'Terjadi kesalahan saat mengunggah website');
                        });
                })
                .catch(error => {
                    console.error('Error saving website:', error);
                    showAlert(uploadAlert, 'error', 'Terjadi kesalahan saat mengunggah website');
                });
        }

        // Fungsi untuk membaca file HTML
        websiteFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file || !file.name.endsWith('.html')) {
                showAlert(uploadAlert, 'error', 'Harap pilih file HTML');
                return;
            }

            const reader = new FileReader();
            reader.onload = (event) => {
                websiteHtml.value = event.target.result;
            };
            reader.onerror = () => {
                showAlert(uploadAlert, 'error', 'Gagal membaca file HTML');
            };
            reader.readAsText(file);
        });

        // Fungsi untuk memuat website pengguna
        function loadUserWebsites(uid) {
            websitesList.innerHTML = '<p>Memuat website...</p>';
            database.ref('userWebsites/' + uid).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const websiteIds = Object.keys(snapshot.val());
                        if (websiteIds.length === 0) {
                            websitesList.innerHTML = '<p>Anda belum memiliki website.</p>';
                            return;
                        }

                        const websitePromises = websiteIds.map(id =>
                            database.ref('websites/' + id).once('value').then(s => s.val())
                        );

                        Promise.all(websitePromises)
                            .then(websites => displayWebsites(websites))
                            .catch(error => {
                                console.error('Error loading websites:', error);
                                websitesList.innerHTML = '<p>Terjadi kesalahan saat memuat website.</p>';
                            });
                    } else {
                        websitesList.innerHTML = '<p>Anda belum memiliki website.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading user websites:', error);
                    websitesList.innerHTML = '<p>Terjadi kesalahan saat memuat website.</p>';
                });
        }

        // Fungsi untuk menampilkan daftar website
        function displayWebsites(websites) {
            websitesList.innerHTML = '';
            websites.forEach(website => {
                if (!website) return;
                const websiteElement = document.createElement('div');
                websiteElement.className = 'website-item';
                websiteElement.innerHTML = `
                    <h3>${sanitizeHTML(website.name)}</h3>
                    <p>Dibuat: ${new Date(website.createdAt).toLocaleDateString('id-ID')}</p>
                    <p>URL: <a href="${website.url}" target="_blank">${website.url}</a></p>
                    <div class="website-actions">
                        <button class="view-website" data-id="${website.id}">Lihat</button>
                        <button class="delete-website" data-id="${website.id}">Hapus</button>
                    </div>
                `;
                websitesList.appendChild(websiteElement);
            });

            document.querySelectorAll('.view-website').forEach(button => {
                button.addEventListener('click', (e) => {
                    const websiteId = e.target.getAttribute('data-id');
                    window.open(`?website=${websiteId}`, '_blank');
                });
            });

            document.querySelectorAll('.delete-website').forEach(button => {
                button.addEventListener('click', (e) => {
                    const websiteId = e.target.getAttribute('data-id');
                    deleteWebsite(websiteId);
                });
            });
        }

        // Fungsi untuk menghapus website
        function deleteWebsite(websiteId) {
            if (confirm('Apakah Anda yakin ingin menghapus website ini?')) {
                database.ref('websites/' + websiteId).remove()
                    .then(() => {
                        database.ref('userWebsites/' + currentUser.uid + '/' + websiteId).remove()
                            .then(() => {
                                showAlert(uploadAlert, 'success', 'Website berhasil dihapus');
                                loadUserWebsites(currentUser.uid);
                            })
                            .catch(error => {
                                console.error('Error removing user website reference:', error);
                                showAlert(uploadAlert, 'error', 'Terjadi kesalahan saat menghapus website');
                            });
                    })
                    .catch(error => {
                        console.error('Error removing website:', error);
                        showAlert(uploadAlert, 'error', 'Terjadi kesalahan saat menghapus website');
                    });
            }
        }

        // Fungsi untuk memuat halaman admin
        function loadAdminPage() {
            usersList.innerHTML = '<p>Memuat data pengguna...</p>';
            database.ref('users').once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const users = Object.values(snapshot.val());
                        displayUsers(users);
                    } else {
                        usersList.innerHTML = '<p>Tidak ada pengguna terdaftar.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading users:', error);
                    usersList.innerHTML = '<p>Terjadi kesalahan saat memuat data pengguna.</p>';
                });
        }

        // Fungsi untuk menampilkan daftar pengguna
        function displayUsers(users) {
            usersList.innerHTML = '';
            users.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'website-item';
                userElement.innerHTML = `
                    <h3>${sanitizeHTML(user.username)}</h3>
                    <p>ID: ${user.uid}</p>
                    <p>Bergabung: ${new Date(user.createdAt).toLocaleDateString('id-ID')}</p>
                    <div class="website-actions">
                        <button class="view-user-websites" data-uid="${user.uid}">Lihat Website</button>
                        <button class="delete-user" data-uid="${user.uid}">Hapus Pengguna</button>
                    </div>
                    <div class="user-websites" id="websites-${user.uid}"></div>
                `;
                usersList.appendChild(userElement);
            });

            document.querySelectorAll('.view-user-websites').forEach(button => {
                button.addEventListener('click', (e) => {
                    const userId = e.target.getAttribute('data-uid');
                    toggleUserWebsites(userId);
                });
            });

            document.querySelectorAll('.delete-user').forEach(button => {
                button.addEventListener('click', (e) => {
                    const userId = e.target.getAttribute('data-uid');
                    deleteUser(userId);
                });
            });
        }

        // Fungsi untuk menampilkan/sembunyikan website pengguna
        function toggleUserWebsites(userId) {
            const websitesContainer = document.getElementById(`websites-${userId}`);
            if (websitesContainer.innerHTML !== '') {
                websitesContainer.innerHTML = '';
                return;
            }

            websitesContainer.innerHTML = '<p>Memuat website...</p>';
            database.ref('userWebsites/' + userId).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const websiteIds = Object.keys(snapshot.val());
                        if (websiteIds.length === 0) {
                            websitesContainer.innerHTML = '<p>Pengguna ini tidak memiliki website.</p>';
                            return;
                        }

                        const websitePromises = websiteIds.map(id =>
                            database.ref('websites/' + id).once('value').then(s => s.val())
                        );

                        Promise.all(websitePromises)
                            .then(websites => {
                                let websitesHTML = '<h4>Website Pengguna:</h4>';
                                websites.forEach(website => {
                                    if (!website) return;
                                    websitesHTML += `
                                        <div class="website-item">
                                            <h4>${sanitizeHTML(website.name)}</h4>
                                            <p>URL: <a href="${website.url}" target="_blank">${website.url}</a></p>
                                            <button class="delete-website-admin" data-id="${website.id}">Hapus Website</button>
                                        </div>
                                    `;
                                });
                                websitesContainer.innerHTML = websitesHTML;

                                document.querySelectorAll('.delete-website-admin').forEach(button => {
                                    button.addEventListener('click', (e) => {
                                        const websiteId = e.target.getAttribute('data-id');
                                        deleteWebsiteAdmin(websiteId, userId);
                                    });
                                });
                            })
                            .catch(error => {
                                console.error('Error loading user websites:', error);
                                websitesContainer.innerHTML = '<p>Terjadi kesalahan saat memuat website.</p>';
                            });
                    } else {
                        websitesContainer.innerHTML = '<p>Pengguna ini tidak memiliki website.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading user websites:', error);
                    websitesContainer.innerHTML = '<p>Terjadi kesalahan saat memuat website.</p>';
                });
        }

        // Fungsi untuk menghapus pengguna (admin)
        function deleteUser(userId) {
            if (confirm('Apakah Anda yakin ingin menghapus pengguna ini? Tindakan ini akan menghapus semua website yang dimilikinya.')) {
                database.ref('userWebsites/' + userId).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            const websiteIds = Object.keys(snapshot.val());
                            const deletePromises = websiteIds.map(id => database.ref('websites/' + id).remove());
                            Promise.all(deletePromises)
                                .then(() => {
                                    database.ref('userWebsites/' + userId).remove()
                                        .then(() => {
                                            database.ref('users/' + userId).remove()
                                                .then(() => {
                                                    alert('Pengguna berhasil dihapus');
                                                    loadAdminPage();
                                                })
                                                .catch(error => {
                                                    console.error('Error removing user:', error);
                                                    alert('Terjadi kesalahan saat menghapus pengguna');
                                                });
                                        })
                                        .catch(error => {
                                            console.error('Error removing user websites reference:', error);
                                            alert('Terjadi kesalahan saat menghapus pengguna');
                                        });
                                })
                                .catch(error => {
                                    console.error('Error removing websites:', error);
                                    alert('Terjadi kesalahan saat menghapus website pengguna');
                                });
                        } else {
                            database.ref('users/' + userId).remove()
                                .then(() => {
                                    alert('Pengguna berhasil dihapus');
                                    loadAdminPage();
                                })
                                .catch(error => {
                                    console.error('Error removing user:', error);
                                    alert('Terjadi kesalahan saat menghapus pengguna');
                                });
                        }
                    })
                    .catch(error => {
                        console.error('Error checking user websites:', error);
                        alert('Terjadi kesalahan saat memeriksa website pengguna');
                    });
            }
        }

        // Fungsi untuk menghapus website (admin)
        function deleteWebsiteAdmin(websiteId, userId) {
            if (confirm('Apakah Anda yakin ingin menghapus website ini?')) {
                database.ref('websites/' + websiteId).remove()
                    .then(() => {
                        database.ref('userWebsites/' + userId + '/' + websiteId).remove()
                            .then(() => {
                                alert('Website berhasil dihapus');
                                toggleUserWebsites(userId);
                            })
                            .catch(error => {
                                console.error('Error removing user website reference:', error);
                                alert('Terjadi kesalahan saat menghapus website');
                            });
                    })
                    .catch(error => {
                        console.error('Error removing website:', error);
                        alert('Terjadi kesalahan saat menghapus website');
                    });
            }
        }

        // Fungsi untuk menampilkan alert
        function showAlert(container, type, message) {
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        // Fungsi untuk menghasilkan UID
        function generateUID() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Fungsi untuk menangani parameter URL
        function handleUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const websiteId = urlParams.get('website');
            if (websiteId) {
                database.ref('websites/' + websiteId).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            const website = snapshot.val();
                            document.body.innerHTML = website.html;
                        } else {
                            document.body.innerHTML = `
                                <div class="container">
                                    <h1>Website Tidak Ditemukan</h1>
                                    <p>Website yang Anda cari tidak ditemukan atau telah dihapus.</p>
                                    <a href="${window.location.origin}${window.location.pathname}">Kembali ke beranda</a>
                                </div>
                            `;
                        }
                    })
                    .catch(error => {
                        console.error('Error loading website:', error);
                        document.body.innerHTML = `
                            <div class="container">
                                <h1>Terjadi Kesalahan</h1>
                                <p>Terjadi kesalahan saat memuat website.</p>
                                <a href="${window.location.origin}${window.location.pathname}">Kembali ke beranda</a>
                            </div>
                        `;
                    });
            }
        }

        // Event Listeners
        hamburger.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        homeLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(homePage);
        });

        loginLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(loginPage);
        });

        registerLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(registerPage);
        });

        dashboardLink.addEventListener('click', (e) => {
            e.preventDefault();
            if (currentUser) {
                userName.textContent = currentUser.username;
                showPage(dashboardPage);
                loadUserWebsites(currentUser.uid);
            }
        });

        adminLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(adminPage);
            loadAdminPage();
        });

        logoutLink.addEventListener('click', (e) => {
            e.preventDefault();
            currentUser = null;
            isAdmin = false;
            updateUI(null);
        });

        loginBtn.addEventListener('click', () => {
            login(loginUsername.value.trim());
        });

        registerBtn.addEventListener('click', () => {
            register(registerUsername.value.trim());
        });

        uploadBtn.addEventListener('click', uploadWebsite);

        // Inisialisasi aplikasi
        function init() {
            if (window.location.search.includes('website=')) {
                handleUrlParams();
                return;
            }
            updateUI(null);
            showPage(homePage);
        }

        init();
    </script>
</body>
</html>
